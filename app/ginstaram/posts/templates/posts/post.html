{% extends "base/base.html" %}
{% block contents %}
      <!-- post section-->
      <section>
        {% if error %}
        <div class="row p-4 text-left">
          <div class="col-6 offset-3">
            <div class="alert alert-danger">{{ error }}</div>
          </div>
        </div>
        {% endif %}
        <div class="row p-4">
          <div class ="col-4 offset-4">
            <form action="post/request" method="POST"  enctype="multipart/form-data"> 
              {% csrf_token %}
              <div class="form-group">
                <label for="picture">アップロードする画像を選択してください</label>
                <input type="file" name="picture" id="picture" class="form-control-file" required>
              </div>
              <div class="preview"></div>
              <div class="form-group pt-3">
                <label for="text">ディスクリプション</label>
                <textarea class="form-control" id="text" name="text" rows="5"></textarea>
              </div>
              <div class="form-group mt-3">
                <input type="submit" value="投稿" class="btn btn-primary form-control">
              </div>
            </form>
          </div>
        </div>
      </section>
      <!-- /post section-->

      <script>
$(function(){
  //画像ファイルプレビュー表示のイベント追加 fileを選択時に発火するイベントを登録
  $('form').on('change', 'input[type="file"]', function(e) {
    var file = e.target.files[0],
        reader = new FileReader(),
        $preview = $(".preview");
        t = this;

    // 画像ファイル以外の場合は何もしない
    if(file.type.indexOf("image") < 0){
      return false;
    }

    // ファイル読み込みが完了した際のイベント登録
    reader.onload = (function(file) {
      return function(e) {
        //既存のプレビューを削除
        $preview.empty();
        // .prevewの領域の中にロードした画像を表示するimageタグを追加
        $preview.append($('<img>').attr({
                  src: e.target.result,
                  width: "100%",
                  class: "preview",
                  title: file.name
              }));
      };
    })(file);

    reader.readAsDataURL(file);
  });
});

      </script>
{% endblock contents %}
